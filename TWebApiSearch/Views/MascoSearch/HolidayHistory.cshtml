
@{
    Layout = "~/Views/Shared/_Layout2.cshtml";
    ViewBag.Title = "AdvanceHistory";
}
<link href="~/Content/Customcss/style.css" rel="stylesheet" />
<link href="~/Content/Customcss/tblStyle.css" rel="stylesheet" />

<div class="panel panel-primary">
    <div class="panel panel-heading">Holiday History</div>
    <div class="panel panel-body">
        <div class="form-group row">
            <label class="col-md-2"> Financial Year</label>
            <div class="col-md-4">
                <select class="form-control" id="ddlFinalcialYear">
                    <option value=""></option>
                </select>
            </div>
            <label class="col-md-2"> Month</label>
            <div class="col-md-4">
                <select class="form-control select2" id="ddlMonth">
                    <option value="-1">All</option>
                    <option value="January">January</option>
                    <option value="February">February</option>
                    <option value="March">March</option>
                    <option value="April">April</option>
                    <option value="May">May</option>
                    <option value="June">June</option>
                    <option value="July">July</option>
                    <option value="August">August</option>
                    <option value="September">September</option>
                    <option value="October">October</option>
                    <option value="November">November</option>
                    <option value="December">December</option>
                </select>
            </div>
        </div>


        <table class="table table-bordered tblHeader tblbody" id="gvHolidayHistory" style="text-align: center">
            <thead style="text-align: center">
            <tr>
                <th>SL</th>
                <th>Month</th>
                <th>Date</th>
                <th>In Punch</th>
                <th>Out Punch</th>
              @*  <th>Holiday Amount</th>*@
            </tr>
            </thead>
            <tbody style="text-align: center"></tbody>
            <tfoot style="border: 2px dotted #cccccc;background-color: slategray;font-size: 17px;font-weight: bold;text-align: center;color: #ffffff">
                <tr>
                    <td></td>
                    <td style="text-align: center"></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    @*<td></td>*@
                </tr>

            </tfoot>
        </table>
    </div>
   
</div>


<script>
    $(document).ready(function () {
        getFinalcialYear();
    });
        function GetHolidayHistory(finalcialYear, Month) {
            $.ajax({
                url: '@Url.Action("GetHolidayHistory", "MascoSearch")',
                type: "POST",
                data: JSON.stringify({ "finalcialYear": finalcialYear, "Month": Month }),
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                success: function (results) {
                    $("#gvHolidayHistory tbody").empty();
                    var ddd = JSON.parse(results);
                    var HolDayBill = 0;
                    for (var i = 0; i < ddd.length; i++) {
                        let tr = "<tr>";
                        tr += "<td>" + (i + 1) + "</td>";
                        tr += "<td style='text-align:center'>" + ddd[i].MonthName + "</td>";
                        tr += "<td>" + ddd[i].PunchDate + "</td>";
                        tr += "<td>" + ddd[i].FPunchIn + "</td>";
                        tr += "<td>" + ddd[i].FPunchOut + "</td>";
                        //tr += "<td style='text-align:right'>" + ddd[i].HolDayAmt + "</td>";
                        tr += "</tr>";
                        HolDayBill = parseInt(ddd[i].HolDayAmt);
                        $("#gvHolidayHistory tbody").append(tr);
                    }

                    var tRow = $("#gvHolidayHistory tfoot tr");
                    $(tRow).find('td:eq(1)').text("Total");
                    $(tRow).find('td:eq(4)').text(HolDayBill);
                },
                error: function (data) {

                }
            });
        }
        function getFinalcialYear() {
            $.ajax({
                url: '@Url.Action("GetFinalCialYear", "MascoSearch")',
                type: "POST",
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                success: function(results) {
                    $('#ddlFinalcialYear').get(0).options.length = 0;
                    $('#ddlFinalcialYear').get(0).options[0] = new Option('Select--------', '');

                    $.map(results.Data, function(item) {
                        $('#ddlFinalcialYear').get(0).options[$('#ddlFinalcialYear').get(0).options.length] = new Option(item.Text, item.ID);
                    });

                    $('#ddlFinalcialYear').val(results.SelectedVal);
                    let finalcialYear = $('#ddlFinalcialYear').val();

                    if ($("#ddlMonth").val() == '-1') {
                        GetHolidayHistory(finalcialYear, '');
                    } else {
                        GetHolidayHistory(finalcialYear, $("#ddlMonth").val());
                    }

                },
                error: function(data) {

                }
            });
        }

        $("#ddlFinalcialYear").change(function () {
            let finalcialYear = $(this).val();
            if (finalcialYear == "") { $("#gvHolidayHistory tbody").empty(); return false; } else {

                if ($("#ddlMonth").val() == '-1') {
                    GetHolidayHistory(finalcialYear, '');
                } else {
                    GetHolidayHistory(finalcialYear, $("#ddlMonth").val());
                }
            }

        });

        $("#ddlMonth").change(function () {
            let finalcialYear = $("#ddlFinalcialYear").val();
            if (finalcialYear == "") { $("#gvHolidayHistory tbody").empty(); return false; } else {
                if ($("#ddlMonth").val() == '-1') {
                    GetHolidayHistory(finalcialYear, '');
                } else {
                    GetHolidayHistory(finalcialYear, $("#ddlMonth").val());
                }
            }

        });
        
  
</script>
